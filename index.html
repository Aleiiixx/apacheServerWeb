#!/bin/bash

# Determina si el método de solicitud es POST
if [ "$REQUEST_METHOD" = "POST" ]; then
    read -n $CONTENT_LENGTH post_data
    pid=$(echo $post_data | sed 's/pid=//')
    echo "Intentando matar PID: $pid" >&2 # Esto se escribirá en el log de errores del servidor web
    kill $pid 2>&1
    kill_result=$?
    if [ $kill_result -eq 0 ]; then
        echo "PID $pid terminado con éxito." >&2
    else
        echo "Error al terminar PID $pid." >&2
    fi
fi

echo "Content-type: text/html"
echo ""

cat <<EOF
<html>
    <head>
        <title>Mi primera pagina dinamica</title>
    </head>
    <body>
        <pre>
$(ps aux)
        </pre>
        <form method='POST' action='/cgi-bin/script.sh'>
            <label for='pid'>PID:</label>
            <input type='text' id='pid' name='pid'>
            <input type='submit' value='Matar'>
        </form>
    </body>
</html>
EOF
