#!/bin/bash

if [ "$REQUEST_METHOD" = "POST" ]; then
    read -r CONTENT_LENGTH
    read -r QUERY_STRING
    read -r POST_DATA
    pid=$(echo "$POST_DATA" | grep -oP "(?<=pid=)[^&]+")
    if [ -n "$pid" ]; then
        kill -9 "$pid"
        cat <<HTML
Content-type: text/html

<html>
    <head>
        <title>Mi primera pagina dinamica</title>
    </head>
    <body>
        <h1>Proceso con PID $pid ha sido terminado.</h1>
        <a href='$SCRIPT_NAME'>Volver</a>
    </body>
</html>
HTML
    else
        cat <<HTML
Content-type: text/html

<html>
    <head>
        <title>Mi primera pagina dinamica</title>
    </head>
    <body>
        <h1>Error: PID no proporcionado.</h1>
        <a href='$SCRIPT_NAME'>Volver</a>
    </body>
</html>
HTML
    fi
else
    cat <<HTML
Content-type: text/html

<html>
    <head>
        <title>Mi primera pagina dinamica</title>
    </head>
    <body>
        <h1>Lista de procesos:</h1>
        <pre>
$(ps aux)
        </pre>
        <h2>Matar Proceso</h2>
        <form action='$SCRIPT_NAME' method='POST'>
            <label for='pid'>PID:</label>
            <input type='text' id='pid' name='pid'>
            <input type='submit' value='Matar' name='submit'>
        </form>
    </body>
</html>
HTML
fi
